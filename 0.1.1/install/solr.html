<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.9.1 from src/site/xdoc/install/solr.xml.vm at 2020-05-21
 | Rendered using Apache Maven Fluido Skin 1.8
-->
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="generator" content="Apache Maven Doxia Site Renderer 1.9.1" />
    <title>Registry Application &#x2013; Apache Solr</title>
    <link rel="stylesheet" href="../css/apache-maven-fluido-1.8.min.css" />
    <link rel="stylesheet" href="../css/site.css" />
    <link rel="stylesheet" href="../css/print.css" media="print" />
    <script src="../js/apache-maven-fluido-1.8.min.js"></script>
  </head>
  <body class="topBarDisabled">
    <div class="container-fluid">
      <header>
        <div id="banner">
          <div class="pull-left"><a href="https://github.com/NASA-PDS/pds-registry-app" id="bannerLeft"><img src="../images/pds4_logo.png"  alt=""/></a></div>
          <div class="pull-right"><div id="bannerRight"><h2>PDS Registry</h2>
</div>
</div>
          <div class="clear"><hr/></div>
        </div>

        <div id="breadcrumbs">
          <ul class="breadcrumb">
        <li id="publishDate">Last Published: 2020-05-21<span class="divider">|</span>
</li>
          <li id="projectVersion">Version: 0.1.1</li>
      <li class="pull-right"><a href="https://github.com/NASA-PDS/pds-registry-app" class="externalLink" title="Registry App Github Repo">Registry App Github Repo</a></li>
          </ul>
        </div>
      </header>
      <div class="row-fluid">
        <header id="leftColumn" class="span2">
          <nav class="well sidebar-nav">
  <ul class="nav nav-list">
   <li class="nav-header">Software Documentation</li>
    <li><a href="../index.html" title="About PDS Registry Application"><span class="none"></span>About PDS Registry Application</a></li>
    <li><a href="../install/index.html" title="Installation"><span class="icon-chevron-down"></span>Installation</a>
     <ul class="nav nav-list">
      <li><a href="../install/java.html" title="Java"><span class="none"></span>Java</a></li>
      <li class="active"><a href="#"><span class="none"></span>Solr</a></li>
      <li><a href="../install/tools.html" title="Tools (manager, harvest)"><span class="none"></span>Tools (manager, harvest)</a></li>
      <li><a href="../install/initialize.html" title="Initialize the registry"><span class="none"></span>Initialize the registry</a></li>
      <li><a href="../install/test.html" title="Test your deployment"><span class="none"></span>Test your deployment</a></li>
     </ul></li>
    <li><a href="../operate/index.html" title="Operation"><span class="icon-chevron-down"></span>Operation</a>
     <ul class="nav nav-list">
      <li><a href="../operate/harvest.html" title="Harvest"><span class="none"></span>Harvest</a></li>
      <li><a href="../operate/reg-manager.html" title="Registry Manager"><span class="none"></span>Registry Manager</a></li>
      <li><a href="../operate/reg-collection.html" title="Registry Collection"><span class="none"></span>Registry Collection</a></li>
      <li><a href="../operate/solr-tools.html" title="Solr Tools"><span class="none"></span>Solr Tools</a></li>
     </ul></li>
    <li><a href="../index.html#Support" title="Support"><span class="none"></span>Support</a></li>
   <li class="nav-header">Downloads</li>
    <li><a href="https://github.com/NASA-PDS/pds-registry-app/releases/download/0.1.1/pds-registry-app-0.1.1-bin.tar.gz" class="externalLink" title="Current Release (tar.gz)"><span class="none"></span>Current Release (tar.gz)</a></li>
    <li><a href="https://github.com/NASA-PDS/pds-registry-app/releases/download/0.1.1/pds-registry-app-0.1.1-bin.zip" class="externalLink" title="Current Release (zip)"><span class="none"></span>Current Release (zip)</a></li>
    <li><a href="https://pds-engineering.jpl.nasa.gov/content/pds4-software" class="externalLink" title="Past Releases"><span class="none"></span>Past Releases</a></li>
   <li class="nav-header">Change Log</li>
    <li><a href="../" title="TBD"><span class="none"></span>TBD</a></li>
   <li class="nav-header">Project Documentation</li>
    <li><a href="../project-info.html" title="Project Information"><span class="icon-chevron-right"></span>Project Information</a></li>
    <li><a href="../project-reports.html" title="Project Reports"><span class="icon-chevron-right"></span>Project Reports</a></li>
  </ul>
          </nav>
          <div class="well sidebar-nav">
            <hr />
            <div id="poweredBy">
              <div class="clear"></div>
              <div class="clear"></div>
              <div class="clear"></div>
<a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy"><img class="builtBy" alt="Built by Maven" src="../images/logos/maven-feather.png" /></a>
            </div>
          </div>
        </header>
        <main id="bodyColumn"  class="span10" >


<section>
<h2><a name="Apache_Solr"></a>Apache Solr</h2>
  
  
<ul>
    
<li><a href="#SolrCloud_Overview">SolrCloud Overview</a></li>
    
<ul>
      
<li><a href="#Multinode_Cluster">Multinode Cluster</a></li>
      
<li><a href="#Single_Node_Cluster_with_Embedded_ZooKeeper">Single Node Cluster with Embedded ZooKeeper</a></li>
      
<li><a href="#Single_Node_Cluster_with_Separate_ZooKeeper">Single Node Cluster with Separate ZooKeeper</a></li>
    </ul>
    
<li><a href="#Installation">Installation</a></li>
    
<ul>
      
<li><a href="#Single_Node_Cluster_with_Embedded_ZooKeeper">Single Node Cluster with Embedded ZooKeeper</a></li>
      
<li><a href="#Using_Docker">Using Docker</a></li>
    </ul>
    
<li><a href="#Security">Security</a></li>
    
<li><a href="#Setup_HTTP_Proxy_for_Solr_Admin_UI">Setup HTTP Proxy for Solr Admin UI</a></li>
    
<li><a href="#Next_Steps">Next Steps</a></li>
    
<li><a href="#Common_Errors">Common Errors</a></li>
  </ul>


<p>
PDS Registry requires <a class="externalLink" href="https://lucene.apache.org/solr/" target="_blank">Apache Solr</a>.
Solr has to be installed and started in cloud mode before running PDS Registry.

PDS Registry has been tested with Solr version 8.4.1.
</p>


<p>
Solr can run in two modes: 
</p>
<ul>
  
<li><b>SolrCloud - this is the only mode support by the PDS EN Registry tools</b></li>
  
<li>Standalone - this can be used for your own Solr testing purposes.</li> 
</ul>




<section>
<h3><a name="SolrCloud_Overview"></a>SolrCloud Overview</h3>

<p>
SolrCloud is a cluster of Solr servers that provides fault tolerance and high availability.
It uses Apache ZooKeeper for cluster configuration and coordination.
Number of nodes you need, usually depends on amount of data, number of queries, fault tolerance and high availability requirements.
</p>

<section>
<h4><a name="Multinode_Cluster"></a>Multinode Cluster</h4>

<p>
Below is a simplified diagram of a production setup with 3 node ZooKeeper cluster 
and multinode Solr cluster. Both ZooKeeper and Solr clusters can be expanded by adding more nodes.
This setup provides fault tolerance and high availability.
</p>
<img src="../images/solr-cluster.jpg" width="35%" alt="" />

</section><section>
<h4><a name="Single_Node_Cluster_with_Embedded_ZooKeeper"></a>Single Node Cluster with Embedded ZooKeeper</h4>

<p>
This is the simplest configuration of SolrCloud. A single instance of ZooKeeper and Solr server are running in the same JVM.
This setup does not provide any fault tolerance or high availability, and could not be expanded.
This configuration is recommended for development or testing and can be easily installed on a laptop or desktop.
</p>
<img src="../images/solr-cluster-1a.jpg" width="25%" alt="" />

</section><section>
<h4><a name="Single_Node_Cluster_with_Separate_ZooKeeper"></a>Single Node Cluster with Separate ZooKeeper</h4>

<p>
This configuration has single node ZooKeeper and single node Solr server running in different JVMs.
This setup can be easily expanded by addning more ZooKeeper or Solr nodes.
</p>

<img src="../images/solr-cluster-1b.jpg" width="30%" alt="" />
</section></section>



<section>
<h3><a name="Installation"></a>Installation</h3>

<section>
<h4><a name="Single_Node_Cluster_with_Embedded_ZooKeeper"></a>Single Node Cluster with Embedded ZooKeeper</h4>

<ul>
  
<li>Download the Solr 8.4.1 <a class="externalLink" href="http://archive.apache.org/dist/lucene/solr/8.4.1/solr-8.4.1.zip">ZIP</a> or <a class="externalLink" href="http://archive.apache.org/dist/lucene/solr/8.4.1/solr-8.4.1.tgz">TAR</a> package.</li>
  
<li>Unzip it to any directory, for example, <i>/opt/solr-8.4.1</i>. We will call this directory <i>SOLR_HOME</i> throughout the rest of this documentation.</li>
  
<li>Go to <i>SOLR_HOME/bin</i> and run <i>solr.cmd</i> on Windows or <i>solr</i> on Unix or Mac.</li> 
  
<li>Pass <b>start</b> and <b>-cloud</b> parameters to start Solr in cloud mode.
    
<div class="source"><pre class="prettyprint">
# Unix or Mac
./solr start -cloud

# Windows
solr.cmd start -cloud
    </pre></div>
  </li>
  
<li>Check that Solr server started in cloud mode. Depending upon where you are installing this software, there are 2 ways to test it started successfully:
    
<ul>
      
<li>Open the Solr Admin UI:
        
<ul>
          
<li>From a native machine or through XWindows: <a class="externalLink" href="http://localhost:8983/solr/">http://localhost:8983/solr/</a> or <a class="externalLink" href="http://127.0.0.1:8983/solr/">http://127.0.0.1:8983/solr/</a></li>
          
<li>From a remote server / host machine: http://my.hostname.com:8983/solr/. NOTE: Depending on how your machine ports are secured, you may need SA assistance to get this port opened or <a href="#Setup_HTTP_Proxy_for_Solr_Admin_UI">see below for information on setting up an Apache proxy.</a></li>
        </ul>
        
<p>
          <br />You should see a page similar to this.
        </p>
        
<p>
          <img src="../images/solr-adm1.jpg" width="90%" alt="" />
        </p>
        
        
<p>
          Check that <i>Cloud</i> menu item is available on the left. Click it. You should see a page similar to this.
        </p>
        
<p>
          <img src="../images/solr-adm2.jpg" width="85%" alt="" />
        </p>
      </li>
      
<li>If experiencing issues accessing the Admin UI, try the following to verify the server started as expected:
        
<div class="source"><pre class="prettyprint">
$ ./solr status

Found 1 Solr nodes:

Solr process 55672 running on port 8983
{
&quot;solr_home&quot;:&quot;/opt/solr-8.4.1/server/solr&quot;,
&quot;version&quot;:&quot;8.4.1 832bf13dd9187095831caf69783179d41059d013 - ishan - 2020-01-10 13:40:28&quot;,
&quot;startTime&quot;:&quot;2020-04-11T01:48:15.071Z&quot;,
&quot;uptime&quot;:&quot;0 days, 0 hours, 2 minutes, 23 seconds&quot;,
&quot;memory&quot;:&quot;91.7 MB (%17.9) of 512 MB&quot;,
&quot;cloud&quot;:{
&quot;ZooKeeper&quot;:&quot;localhost:9983&quot;,
&quot;liveNodes&quot;:&quot;1&quot;,
&quot;collections&quot;:&quot;0&quot;}}
        </pre></div>
      </li>
    </ul>
  </li>
</ul>

</section><section>
<h4><a name="Using_Docker"></a>Using Docker</h4>

<p>
You can run Solr in Docker or Podman. Use the official Solr image from DockerHub (solr:8.4).
Map both ZooKeeper (9983) and Solr (8983) ports. 
You would need access to ZooKeeper to upload PDS registry collection configset.
Do not forget to pass <b>-cloud</b> parameter to start Solr in cloud mode.
</p>

<p>
The following example is for CentOS 8 / RHEL 8 which usually have Podman preinstalled (available in AppStream).
If your system has Docker, use <i>docker</i> command with the same parameters.
</p>

<div class="source"><pre class="prettyprint">
podman run -p 8983:8983 -p 9983:9983 -d --name solr -t solr:8.4 -cloud
</pre></div>

</section></section>

<section>
<h2><a name="Security"></a>Security</h2>


<p>Currently, we are working on defining a more comprehensive Security component for the Registry. In the meantime, it is recommended this service 
  be installed on servers that allow internal access only.
</p>

</section>
  
<section>
<h2><a name="Setup_HTTP_Proxy_for_Solr_Admin_UI"></a>Setup HTTP Proxy for Solr Admin UI</h2>
  
<p>To view the Solr Admin UI on a remote server, you will need to have your System Administrator setup a proxy similar to the following:
  </p>
<div class="source"><pre class="prettyprint">
ProxyPass /solr/ http://localhost:8983/solr/
ProxyPassReverse /solr/ http://localhost:8983/solr/
ProxyPass /solr http://localhost:8983/solr
ProxyPassReverse /solr http://localhost:8983/solr
&lt;Location /solr&gt;
  &lt;Limit PUT POST DELETE&gt;
    Order Deny,Allow
    Deny from All
    Allow from 127.0.0.1
  &lt;/Limit&gt;
&lt;/Location&gt;
  </pre></div>
  
</section>




</section>
<section>
<h2><a name="Next_Steps"></a>Next Steps</h2>

<p>Your Solr server is ready, you should now deploy the <a href="tools.html">tools</a> to harvest metadata and manage your registry.</p>
</section>
  
  <section>
<h2><a name="Having_trouble.3F"></a>Having trouble?</h2>
    
<p>If you are having trouble getting Solr to start up and/or access the Admin UI, there are a few potential debugging mechanisms:
    </p>
    
    
<ul>
      
<li>Make sure the 8983 port is open or proxy is setup - this is necessary to access the repo</li>
      
<li>Try replacing localhost with the hostname of your machine - depending on your server setup, localhost may not be accessible</li>
      
<li>Check if anything else is running on that port - make sure you don't have another Solr instance running or a Docker instance up. If so, shutdown or remove the docker image.</li>
    </ul>
  </section>



        </main>
      </div>
    </div>
    <hr/>
    <footer>
      <div class="container-fluid">
        <div class="row-fluid">
            <p>Copyright &#169;      2020..</p>
        </div>
      </div>
    </footer>
  </body>
</html>
