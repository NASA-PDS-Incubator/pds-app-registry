<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.9.1 from src/site/xdoc/operate/index.xml.vm at 2020-03-30
 | Rendered using Apache Maven Fluido Skin 1.8
-->
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="generator" content="Apache Maven Doxia Site Renderer 1.9.1" />
    <title>Registry Application &#x2013; Operation</title>
    <link rel="stylesheet" href="../css/apache-maven-fluido-1.8.min.css" />
    <link rel="stylesheet" href="../css/site.css" />
    <link rel="stylesheet" href="../css/print.css" media="print" />
    <script src="../js/apache-maven-fluido-1.8.min.js"></script>
  </head>
  <body class="topBarDisabled">
    <div class="container-fluid">
      <header>
        <div id="banner">
          <div class="pull-left"><a href="https://github.com/NASA-PDS-Incubator/pds-app-registry" id="bannerLeft"><img src="../images/pds4_logo.png"  alt=""/></a></div>
          <div class="pull-right"><div id="bannerRight"><h2>PDS Registry</h2>
</div>
</div>
          <div class="clear"><hr/></div>
        </div>

        <div id="breadcrumbs">
          <ul class="breadcrumb">
        <li id="publishDate">Last Published: 2020-03-30<span class="divider">|</span>
</li>
          <li id="projectVersion">Version: 0.1.0-SNAPSHOT</li>
      <li class="pull-right"><a href="https://github.com/NASA-PDS-Incubator/pds-app-registry" class="externalLink" title="Registry App Github Repo">Registry App Github Repo</a></li>
          </ul>
        </div>
      </header>
      <div class="row-fluid">
        <header id="leftColumn" class="span2">
          <nav class="well sidebar-nav">
  <ul class="nav nav-list">
   <li class="nav-header">Software Documentation</li>
    <li><a href="../index.html" title="About PDS Registry Application"><span class="none"></span>About PDS Registry Application</a></li>
    <li><a href="../install/index.html" title="Installation"><span class="icon-chevron-down"></span>Installation</a>
     <ul class="nav nav-list">
      <li><a href="../install/java.html" title="Java"><span class="none"></span>Java</a></li>
      <li><a href="../install/solr.html" title="Solr"><span class="none"></span>Solr</a></li>
      <li><a href="../install/tools.html" title="Tools (manager, harvest)"><span class="none"></span>Tools (manager, harvest)</a></li>
      <li><a href="../install/initialize.html" title="Initialize the registry"><span class="none"></span>Initialize the registry</a></li>
      <li><a href="../install/test.html" title="Test your deployment"><span class="none"></span>Test your deployment</a></li>
     </ul></li>
    <li class="active"><a href="#"><span class="icon-chevron-down"></span>Operation</a>
     <ul class="nav nav-list">
      <li><a href="../operate/harvest.html" title="Harvest"><span class="none"></span>Harvest</a></li>
      <li><a href="../operate/reg-manager.html" title="Registry Manager"><span class="none"></span>Registry Manager</a></li>
      <li><a href="../operate/reg-collection.html" title="Registry Collection"><span class="none"></span>Registry Collection</a></li>
      <li><a href="../operate/solr-tools.html" title="Solr Tools"><span class="none"></span>Solr Tools</a></li>
     </ul></li>
   <li class="nav-header">Downloads</li>
    <li><a href="https://github.com/NASA-PDS-Incubator/pds-app-registry/releases/download/0.1.0-SNAPSHOT/pds-app-registry-0.1.0-SNAPSHOT-bin.tar.gz" class="externalLink" title="Current Release (tar.gz)"><span class="none"></span>Current Release (tar.gz)</a></li>
    <li><a href="https://github.com/NASA-PDS-Incubator/pds-app-registry/releases/download/0.1.0-SNAPSHOT/pds-app-registry-0.1.0-SNAPSHOT-bin.zip" class="externalLink" title="Current Release (zip)"><span class="none"></span>Current Release (zip)</a></li>
    <li><a href="https://pds-engineering.jpl.nasa.gov/content/pds4-software" class="externalLink" title="Past Releases"><span class="none"></span>Past Releases</a></li>
   <li class="nav-header">Change Log</li>
    <li><a href="../" title="TBD"><span class="none"></span>TBD</a></li>
   <li class="nav-header">Project Documentation</li>
    <li><a href="../project-info.html" title="Project Information"><span class="icon-chevron-right"></span>Project Information</a></li>
    <li><a href="../project-reports.html" title="Project Reports"><span class="icon-chevron-right"></span>Project Reports</a></li>
  </ul>
          </nav>
          <div class="well sidebar-nav">
            <hr />
            <div id="poweredBy">
              <div class="clear"></div>
              <div class="clear"></div>
              <div class="clear"></div>
<a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy"><img class="builtBy" alt="Built by Maven" src="../images/logos/maven-feather.png" /></a>
            </div>
          </div>
        </header>
        <main id="bodyColumn"  class="span10" >



<section>
<h2><a name="Operation_Overview"></a>Operation Overview</h2>

<p>
The high level architecture of PDS Registry and its main components is shown below.
</p>
<img src="../images/registry-harvest.jpg" width="35%" alt="" />
</section>



<section>
<h2><a name="Common_Operations"></a>Common Operations</h2>

<section>
<h3><a name="Extract_PDS4_Product_Metadata"></a>Extract PDS4 Product Metadata</h3>

<p>
Run Harvest tool to crawl PDS4 products and extract metadata. 
The metadata is stored in an &quot;intermediate&quot; XML file which can be loaded into Solr 
by Registry Manager or Solr post tool.
</p>

<p>
In addition to some basic information, such as lid, vid, product class, internal references, 
file name and size, you can configure additional fields to export.
Optionally the whole PDS product labels can be stored as BLOBs (Binary Large OBjects).
</p>

<p>
See <a href="harvest.html">Harvest Documentation</a> for more information.
</p>
</section>

<section>
<h3><a name="Create_or_Delete_Registry_Collection"></a>Create or Delete Registry Collection</h3>

<p>
You must create registry collection in Solr, before loading data generated by Harvest tool.
See <a href="../install/initialize.html">Registry Installation</a> and 
<a href="reg-manager.html">Registry Manager</a> for more information.
</p>

<p>
You may want to add more fields to default schema or change default Solr configuration.
See <a href="reg-collection.html">Registry Collection Configuration</a> and
<a class="externalLink" href="https://lucene.apache.org/solr/guide/documents-fields-and-schema-design.html" target="_blank">Solr Documentation</a>
for more information.
</p>
</section>

<section>
<h3><a name="Load_Metadata_into_Solr"></a>Load Metadata into Solr</h3>

<p>
Intermediate XML file generated by Harvest, can be loaded into Solr 
by <a href="reg-manager.html">Registry Manager</a> or standard 
<a href="solr-tools.html">Solr tools</a>, such as Solr post tool. 
</p>

<p>
The following example shows how to load data with Registry Manager. 
</p>
<div class="source"><pre class="prettyprint">
registry-manager load-data -filePath /home/pds/harvest/solr/solr-docs.xml
</pre></div>

</section>



<section>
<h3><a name="View_.2F_Search_Metadata"></a>View / Search Metadata</h3>

<section>
<h4><a name="Solr_Admin_UI"></a>Solr Admin UI</h4>

<p>
To search registry collection in <a href="solr-tools.html">Solr Admin UI</a> open 
the following URL in a browser <i>http://localhost:8983/solr</i>, select <i>registry</i>
collection from a dropdown and then <i>Query</i> menu item.
</p>
<img src="../images/solr-search-ui.jpg" width="80%" alt="" />

</section><section>
<h4><a name="Solr_Search_API"></a>Solr Search API</h4>


<p>
You can find more information about Solr Search API at 
<a class="externalLink" href="https://lucene.apache.org/solr/guide/8_4/json-request-api.html" target="_blank">Solr web site</a>.
</p>

<p>
To call old API, either open the following URL in a browser or use <i>curl</i> command:
</p>
<div class="source"><pre class="prettyprint">
curl &quot;http://localhost:8983/solr/registry/query?q=*:*&quot;
</pre></div>
To call new JSON Search API you have to use <i>curl</i> command:

<div class="source"><pre class="prettyprint">
curl &quot;http://localhost:8983/solr/registry/query&quot; -d '{ &quot;query&quot; : &quot;*:*&quot; }'
</pre></div>

</section></section>



<section>
<h3><a name="Delete_Metadata_from_Solr"></a>Delete Metadata from Solr</h3>

<p>
You can use <a href="reg-manager.html">Registry Manager</a> tool to delete metadata 
by lidvid, lid, package id (Harvest run id), or to delete all data. Few examples are shown below.
</p>
<div class="source"><pre class="prettyprint">
registry-manager delete-data -lidvid urn:nasa:pds:context:target:asteroid.4_vesta::1.1
registry-manager delete-data -lid urn:nasa:pds:context:target:asteroid.4_vesta
registry-manager delete-data -packageId 8d8ae96d-044e-473d-a278-62635b1c5977
registry-manager delete-data -all
</pre></div>



<p>
You can also delete data from Solr by calling Solr update API 
</p>
<div class="source"><pre class="prettyprint">
$ curl 'http://localhost:8983/solr/registry/update/' --data-binary &quot;&lt;delete&gt;&lt;query&gt;*:*&lt;/query&gt;&lt;/delete&gt;&quot;
</pre></div>

</section>



<section>
<h3><a name="Reingest_Data_to_Registry"></a>Reingest Data to Registry</h3>

<p>
Registry collection uses lidvid as a primary key. If you load data multiple times, 
old documents will be replaced by new documents with the same lidvid.
To avoid any orphan records, you may want to delete old documents first.
</p>
</section>



<section>
<h3><a name="Export_a_File_from_Registry_BLOB"></a>Export a File from Registry BLOB</h3>

<p>
If PDS product label BLOBs (Binary Large OBjects) were generated by Harvest, they can be exported 
by <a href="reg-manager.html">Registry Manager</a> tool as shown below.
</p>
<div class="source"><pre class="prettyprint">
registry-manager export-file -lidvid urn:nasa:pds:context:target:asteroid.4_vesta::1.1 -filePath /tmp/4_vesta.xml
</pre></div>


</section>

</section>



        </main>
      </div>
    </div>
    <hr/>
    <footer>
      <div class="container-fluid">
        <div class="row-fluid">
            <p>Copyright &#169;      2020..</p>
        </div>
      </div>
    </footer>
  </body>
</html>
